---
layout: post
title: keras-í•¨ìˆ˜í˜• API
categories: deeplearning
tags: cnn
---

### ğŸ’¡ Image Augmentation

ì´ë¯¸ì§€ ë³´ê°•ì€ í›ˆë ¨ë°ì´í„°ì— ì—†ëŠ” ì´ë¯¸ì§€ë¥¼ ë§Œë“¤ì–´ë‚´ì„œ í›ˆë ¨ë°ì´í„°ë¥¼ 

ë³´ê°•í•˜ëŠ” ê¸°ë²•ì„ ë§í•œë‹¤. Tensorflowì—ëŠ” ì´ë¯¸ì§€ ë³´ê°• ì‘ì—…ì„ ì‰½ê²Œ í•´ì£¼ëŠ” 

ImageDataGeneratorê°€ ìˆë‹¤.

âœğŸ¼ [keras-docs](https://keras.io/ko/preprocessing/image/)

```python
import tensorflow as tf
from tensorflow.keras.preprocessing.image import ImageDataGenerator
from tensorflow.keras.datasets.fashion_mnist import load_data

# fashion_mnist ë°ì´í„° ë¡œë“œ
(x_train,y_train),(x_test,y_test) = load_data()

# inputì— ë„£ì„ ìˆ˜ ìˆê²Œ shape ë³€í™˜
x_train = x_train.reshape(len(x_train),28,28,1)
y_train = y_train.reshape(len(x_train),28,28,1)

# 0~1 ì‚¬ì´ì˜ ê°’ìœ¼ë¡œ ì •ê·œí™” / 255: í”½ì…€ ê°’
x_train = x_train/255.0
y_train = y_train/255.0

# ì´ë¯¸ì§€ ì¦ê°• ë¡œì§
image_generator = ImageDataGenerator(
    rotation_range = 15,
    zoom_range = 0.1,
    width_shift_range = 0.15,
    height_shift_range = 0.1,
    horizontal_flip = True,
    vertical_flip = False
)

# ì¦ê°•í•  ì´ë¯¸ì§€ ê°œìˆ˜
augment_size = 30000

# 0~59999 ì‚¬ì´ì˜ ìˆ«ìì—ì„œ 30000ê°œ ëœë¤ ì¶”ì¶œ
random_mask = np.random.randint(x_train.shape[0],size=augment_size)

# 30000ê°œì˜ ìˆ«ìë¥¼ ë¦¬ìŠ¤íŠ¸ë¡œ ë¬¶ì–´ì¤Œ. (copyë¡œ ì›ë³¸ ìœ ì§€)
x_augmented = x_train[random_mask].copy()
y_augmented = y_train[random_mask].copy()

# flow ë©”ì†Œë“œë¥¼ ì‚¬ìš©í•˜ì—¬ ì´ë¯¸ì§€ ì¦ê°•í•˜ê¸°.
x_augmented = image_generator.flow(
    x = x_augmented,                # x : ì…ë ¥ ë°ì´í„°
    y = np.zeros(augment_size),     # y : ë¼ë²¨
    batch_size = augment_size,
    shuffle = False
).next()[0]                         

# ê¸°ì¡´ ì´ë¯¸ì§€ + ì¦ê°•ëœ ì´ë¯¸ì§€
x_train = np.concatenate((x_train,x_augmented))

# ê¸°ì¡´ ì´ë¯¸ì§€ì˜ ë¼ë²¨ + ì¦ê°•ëœ ì´ë¯¸ì§€ì˜ ë¼ë²¨
y_train = np.concatenate((y_train,y_augmented))
```

<br>

ì´ë¯¸ì§€ ì¦ê°•ì´ ëë‚¬ìœ¼ë©´ ëª¨ë¸ì„ êµ¬ì¶•í•˜ê³  í•™ìŠµì„ ì‹œì¼œì£¼ë©´ ëœë‹¤.

ì´ë•Œ í•™ìŠµì„ ì‹œí‚¬ ë• <span style="color:#B8860B">**"ê¸°ì¡´ ì´ë¯¸ì§€ + ì¦ê°•ëœ ì´ë¯¸ì§€"**</span>ë¡œ í•™ìŠµì„ ì‹œí‚¨ë‹¤.

<br>

ì¶”ê°€ì ìœ¼ë¡œ flow ë©”ì†Œë“œë¥¼ ì‚¬ìš©í•˜ì—¬ ì´ë¯¸ì§€ë¥¼ ì¦ê°•í•  ë•Œ, next ë©”ì†Œë“œê°€ ìˆë‹¤.

next ë©”ì†Œë“œëŠ” ë¦¬ìŠ¤íŠ¸ ì•ˆì— ìˆëŠ” ìš”ì†Œë“¤ì„ ìˆœì°¨ì ìœ¼ë¡œ ì‹¤í–‰ ì‹œì¼œì£¼ëŠ” ë¡œì§ì„ ê°–ê³  ìˆë‹¤.

ê·¸ë¦¬ê³  ë’¤ì— [0]ì„ ë¶™í˜”ëŠ”ë° ì•„ë§ˆë„ ì…ë ¥ ë°ì´í„°ì˜ shapeì„ ê°€ì ¸ì˜¤ë ¤ê³  ê·¸ëŸ°ê±° ê°™ë‹¤.

<br>

â–ª ì¦ê°•ëœ ì´ë¯¸ì§€ ì˜ˆì‹œ

<img src="/assets/img/django/aug.png">


