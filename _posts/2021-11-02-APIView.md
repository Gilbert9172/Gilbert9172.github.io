---
layout: post
title: APIView
categories: django
tags: drf
---

### ğŸ’¡ ***Serializerë¥¼ í†µí•œ View ì²˜ë¦¬***

Serializerë¥¼ í†µí•œ View ì²˜ë¦¬ëŠ” Form ì²˜ë¦¬ì™€ ìœ ì‚¬í•œ ë°©ì‹ìœ¼ë¡œ ë™ì‘í•œë‹¤. 

```python
class PostSerializer(serializers.ModelSerializer):
    class Meta:
        model = Post
        fields = '__all__'

# views.py ; ì—¬ê¸°ì„œëŠ” DRFê¸°ëŠ¥ì€ ê±°ì˜ ì—†ë‹¤.
serializer = PostSerialize(data=request.POST)
if serializer.is_valid():
    return JsonReponse(seializer.data, status=200)
return JsonResponse(serializer.errors, status=400)
```

ì—¬ê¸°ì„œ ë‘˜ì˜ ì°¨ì´ì ì€ Form ìƒì„±ìì˜ ì²« ë²ˆì§¸ ì¸ìëŠ” <span style="color:#3CB371">**data**</span>ì´ì§€ë§Œ,

Serializer ìƒì„±ìì˜ ì²« ë²ˆì§¸ ì¸ìëŠ” <span style="color:#3CB371">**instance**</span>ì´ë‹¤.

instance ì¸ìì—ëŠ” 'ëª¨ë¸ ê°ì²´' í˜¹ì€ 'Queryset'ì„ ì „ë‹¬í•´ì¤€ë‹¤.

```python
# django/forms/forms.py/BaseForm
class BaseForm(RenderableFormMixin):
    # ìƒëµ
    def __init__(self,data=None,):
        # ìƒëµ

# rest_framework/serializers.py/BaseSerializer
class BaseSerializer(Field):
    def __init__(self, instance=None, data=empty, **kwargs):
        # ìƒëµ
```
---

<br>

### ğŸ’¡ ***DRFì˜ ê¸°ë³¸ CBVì¸ APIView***

DRFë¥¼ ì‚¬ìš©í•œë‹¤ë©´ "APIView í´ë˜ìŠ¤"ë¥¼ ìƒì† ë°›ì•„ì„œ Viewë¥¼ êµ¬í˜„í•´ì•¼ í•œë‹¤.

ì‹¤ì œë¡œ GenericAPIViewëŠ” APIViewë¥¼ ìƒì† ë°›ê³ , `queryset`ê³¼ `serializer_class`ì„

ì œì™¸í•˜ê³ ëŠ” defaultê°’ì„ ì‚¬ìš©í•œë‹¤.

```python
# rest_framework/generics.py
class GenericAPIView(views.APIView):
    queryset = None
    serializer_class = None
    # ìƒëµ
```
<br>

ë˜í•œ í•¨ìˆ˜ ê¸°ë°˜ Viewë¥¼ êµ¬í˜„í•œë‹¤ë©´, <span style="color:#9932CC">**@api_view**</span>ë¥¼ ì‚¬ìš©í•˜ë©´ ëœë‹¤.

```python
# rest_framework/decorators.py/
def api_view(http_method_names=None):
    """
    FBVë¥¼ APIView í•˜ìœ„ í´ë˜ìŠ¤ë¡œ ë³€í™˜í•˜ëŠ” ë°ì½”ë ˆì´í„°.
    Viewì— ëŒ€í•´ í—ˆìš©ë˜ëŠ” ë©”ì„œë“œ ëª©ë¡ì„ ì¸ìˆ˜ë¡œ ì‚¬ìš©í•œë‹¤.
    """
    http_method_names = ['GET'] if (http_method_names is None) else http_method_names

    def decorator(func):

        WrappedAPIView = type(
            'WrappedAPIView',
            (APIView,),
            {'__doc__': func.__doc__}
        )
```

Pythonì˜ typeì„ í™œìš©í•˜ì—¬ ë™ì ìœ¼ë¡œ `APIView` í´ë˜ìŠ¤ë¥¼ ìƒì† ë°›ì€ 

`WrappedAPIView` í´ë˜ìŠ¤ë¥¼ ë§Œë“¤ì–´ì„œ ë¡œì§ì„ ì²˜ë¦¬í•˜ê³  ìˆë‹¤.

ì¦‰, <span style="color:#9932CC">**@api_view**</span>ë„ `APIView`í´ë˜ìŠ¤ë¥¼ í™œìš©í•˜ê³  ìˆë‹¤ëŠ” ê±¸ í™•ì¸í•  ìˆ˜ ìˆë‹¤.

<br>

`APIView` í´ë˜ìŠ¤ëŠ” Viewì— ì—¬ëŸ¬ ê¸°ë³¸ ì†ì„±ì„ ë¶€ì—¬í•œë‹¤.

ì•„ë˜ì˜ í´ë˜ìŠ¤ëŠ” ëª¨ë‘ ì‚¬ìš©ìê°€ ì»¤ìŠ¤í…€ ê°€ëŠ¥í•˜ë‹¤.

<br>

1. renderer_classes : ì§ë ¬í™” class 
    - rest_framework.renderers.JSONRenderer : JSON ì§ë ¬í™”
    - rest_framework.renderers.TemplateHTMLRendere` : HTML í˜ì´ì§€ ì§ë ¬í™”

2. parser_classes : ë¹„ì§ë ¬í™” class
    - rest_framework.parsers.JSONParser : JSON í¬ë§· ì²˜ë¦¬
    - rest_framework.parsers.FormParser
    - rest_framework.parsers.MultiPartParser

3. authentication_classes : ì¸ì¦ class 
    - userë¥¼ ì‹ë³„í•œë‹¤.
    - rest_framework.authentication.SessionAuthentication : ì„¸ì…˜ì— ê¸°ë°˜í•œ ì¸ì¦
    - rest_framework.authentication.BasicAuthentication : HTTP Basic ì¸ì¦

4. throttle_classes  : ì‚¬ìš©ëŸ‰ ì œí•œ class 
    - ë¹ˆ íŠœí”Œ

5. permission_classes  : ê¶Œí•œ class 
    - userë¥¼ ì‹ë³„ í›„ ê°ê°ì˜ ë¦¬ì†ŒìŠ¤ì— ëŒ€í•´ì„œ ì ‘ê·¼ ê¶Œí•œ í™•ì¸
    - rest_framework.permissions.AllowAny : ëˆ„êµ¬ë¼ë„ ì ‘ê·¼ í—ˆìš©

6. content_negotiation_class  : ìš”ì²­ì— ë”°ë¼ ì ì ˆí•œ ì§ë ¬í™”/ë¹„ì§ë ¬í™” classë¥¼ ì„ íƒí•˜ëŠ” class
    - rest_framework.negotiation.DefaultContentNegotiation
    - ê°™ì€ URLë¡œì˜ ìš”ì²­ì´ì§€ë§Œ, JSONì‘ë‹µì„ ìš”êµ¬í•˜ëŠ” ê²ƒì´ëƒ / HTMLì‘ë‹µì„ ìš”êµ¬í•˜ëŠ” ê²ƒì¸ì§€ íŒë‹¨

7. metadata_class  : ë©”íƒ€ ì •ë³´ë¥¼ ì²˜ë¦¬í•˜ëŠ” class
    - rest_framework.metadata.SimpleMetadata

8. versioning_class  : ìš”ì²­ì—ì„œ APIë²„ì „ ì •ë³´ë¥¼ íƒì§€í•˜ëŠ” class
    - None : API ë²„ì „ ì •ë³´ë¥¼ íƒì§€í•˜ì§€ ì•Šê² ë‹¤
    - ìš”ì²­ URLì—ì„œ, GETì¸ìì—ì„œ, HEADERì—ì„œ ë²„ì „ì •ë³´ë¥¼ íƒì§€í•˜ì—¬, í•´ë‹¹ ë²„ì „ì˜ APIë·°ê°€ í˜¸ì¶œë˜ë„ë¡ í•©ë‹ˆë‹¤.

---

<br>

### ğŸ’¡ ***APIView vs @api_view***

DRFì˜ 2ê°€ì§€ ê¸°ë³¸ Viewê°€ ìˆëŠ”ë°, í•˜ë‚˜ëŠ” APIView(â†” View)ì™€

@api_view(â†” request)ê°€ ìˆë‹¤. ì´ë ‡ê²Œ í•´ì¤˜ì•¼ë§Œ ì•ì—ì„œ ì–¸ê¸‰í–ˆë˜

ê¸°ëŠ¥ë“¤ì„ í™œìš©í•  ìˆ˜ ìˆê²Œ ëœë‹¤.

<br>

#### ğŸ” APIView

APIViewëŠ” í•˜ë‚˜ì˜ CBVë¡œ í•˜ë‚˜ì˜ URLë§Œ ì²˜ë¦¬ê°€ ê°€ëŠ¥í•˜ë‹¤. 

ì´ê²ƒì„ ì¡°ê¸ˆ í‘œì¤€í™”í•´ ë†“ì€ ê²ƒì´ Genericì¸ë°, Genericë„ APIViewì™€ 

ë§ˆì°¬ê°€ì§€ë¡œ í•˜ë‚˜ì˜ URLë§Œ ì²˜ë¦¬ê°€ ê°€ëŠ¥í•˜ë‹¤. 

ë°˜ë©´ì—, ViewSetì€ 2ê°œì˜ URLì„ ì²˜ë¦¬í•  ìˆ˜ ìˆëŠ”ë°, ì´ëŠ” Genericì„ êµ¬ì²´í™” í•œ í´ë˜ìŠ¤ì´ë‹¤.

<br>

ì•„ë˜ëŠ” APIViewì˜ ì´ˆê¸°í™”(Initial) ì„¤ì • ë‹¨ê³„ì¸ë°

```txt
1. ì§ë ¬í™”/ë¹„ì§ë ¬í™” ì²˜ë¦¬ (JSON ë“±)

2. ì¸ì¦ ì²´í¬

3. ì‚¬ìš©ëŸ‰ ì œí•œ ì²´í¬ : í˜¸ì¶œ í—ˆìš©ëŸ‰ ë²”ìœ„ì¸ì§€ ì²´í¬

4. ê¶Œí•œ í´ë˜ìŠ¤ ì§€ì • : ë¹„ì¸ì¦/ì¸ì¦ ìœ ì €ì— ëŒ€í•´ í•´ë‹¹ API í˜¸ì¶œì„ í—ˆìš©í•  ê²ƒì¸ì§€ë¥¼ ê²°ì •

5. ìš”ì²­ëœ API ë²„ì „ ë¬¸ìì—´ì„ íƒì§€í•˜ì—¬, request.versionì— ì €ì¥
```

ì´ˆê¸°í™” ë‹¨ê³„ì—ì„œ í•„ìš”í•œ ê²ƒë“¤ì„ ëª¨ë‘ ì„¤ì •í•œ ì´í›„ì—,

ê° method(get, post, put, delete)ë¥¼ í˜¸ì¶œí•´ ì£¼ëŠ” ê¸°ëŠ¥ì´ APIViewì— ìˆë‹¤.

```python
# rest_framework/views.py

def dispatch(self, request, *args, **kwargs):
    # ìƒëµ
    try:
        self.initial(request, *args, **kwargs)

        if request.method.lower() in self.http_method_names: # ì§€ì›í•˜ëŠ” Http ë©”ì†Œë“œ
            handler = getattr(self, request.method.lower(),
                                self.http_method_not_allowed)
        else:
            handler = self.http_method_not_allowed

        response = handler(request, *args, **kwargs)

    except Exception as exc:
        response = self.handle_exception(exc)

    self.response = self.finalize_response(request, response, *args, **kwargs)
    return self.response

# def initial

def initial(self, request, *args, **kwargs):

    self.format_kwarg = self.get_format_suffix(**kwargs)

    neg = self.perform_content_negotiation(request)
    request.accepted_renderer, request.accepted_media_type = neg

    version, scheme = self.determine_version(request, *args, **kwargs)
    request.version, request.versioning_scheme = version, scheme

    self.perform_authentication(request)
    self.check_permissions(request)
    self.check_throttles(request)
```
---

<br>

#### í´ë˜ìŠ¤ í˜•íƒœì˜ APIViewêµ¬í˜„ (list/create)

```python
from rest_framework.response import Response
from rest_framework.views import APIView
from .models import Post
from .serializers import PostSerializer

class PostListAPIView(APIView):

    def get(self, request):
        qs = Post.objects.all()
        serializer = PostSerializer(qs, many=True)
        return Response(serializer.data)

    def post(self, request):
        serializer = PostSerializer(data=request.user)
        if serializer.is_valid():
            return Response(serializer.data, status=201)
        return Response(serializer.data, status=400)

# rest_framework/views.py 
from django.views.decorators.csrf import csrf_exempt

class APIView(View)
    @classmethod
    def as_view(cls, **initkwargs):
        # ìƒëµ
        return csrf_exempt(view)
```

APIView í´ë˜ìŠ¤ì—ì„œ Viewê°€ ì´ë¯¸ csrf_exemptë¡œ ì´ë¯¸ ê°ì‹¸ì ¸ìˆë‹¤.

ë”°ë¼ì„œ POST ìš”ì²­ì—ì„œ csrf token ì²´í¬ë¥¼ í•˜ë©´ ì•ˆëœë‹¤.


---

<br>

#### í´ë˜ìŠ¤ í˜•íƒœì˜ APIViewêµ¬í˜„ (detail/update/delete)

```python
from django.shortcuts import get_object_or_404
from rest_framework.response import Response
from rest_framework.views import APIView
from .models import Post
from .serializers import PostSerializer

class PostDetailAPIView(APIView):
    def get_object(self, pk):
        return get_object_or_404(Post, pk=pk) 
        
    def get(self, request, pk, format=None):
    post = self.get_object(pk)
    serializer = PostSerializer(post)
        return Response(serializer.data)

    def put(self, request, pk):
        post = self.get_object(pk)
        serializer = PostSerializer(post, data=request.data)
        if serializer.is_valid():
            serializer.save()
            return Response(serializer.data)
        return Response(serializer.errors, status=status.HTTP_400_BAD_REQUEST)

    def delete(self, request, pk):
        post = self.get_object(pk) post.delete()
        return Response(status=status.HTTP_204_NO_CONTENT)
```

í´ë˜ìŠ¤ í˜•íƒœì˜ APIView êµ¬í˜„ì—ì„œ ë°˜ë³µë˜ëŠ” ì½”ë“œë“¤ì´ ë³´ì¸ë‹¤.

ì´ë ‡ê²Œ ë°˜ë³µë˜ëŠ” ë¶€ë¶„ì„ íŒ¨í„´í™” ì‹œì¼œë†“ì€ ê²ƒì´ `Genrics`ë‹¤

---

<br>

#### @api_view í™œìš©í•œ êµ¬í˜„ (list/create)
```python
from django.http import get_object_or_404
from rest_framework import status, Response
from rest_framework.decorators import api_view
from .models import Post
from .serializers import PostSerializer

@api_view(['GET', 'POST'])
def post_list(request):
    if request.method == 'GET':
        serializer = PostSerializer(Post.objects.all(), many=True)
        return Response(serializer.data)
    else:
        serializer = PostSerializer(data=request.data)
        if serializer.is_valid():
            serializer.save()
            return Response(serializer.data, status=201)
        return Response(serializer.errors, status=400)
```
í•¨ìˆ˜ ê¸°ë°˜ì—ì„œëŠ” ë¡œì§ì´ ì „ë¶€ë‹ˆê¹, @api_view ì˜†ì— ì–´ë–¤ methodë¥¼ ì§€ì›í•  ê²ƒì¸ì§€

ë¦¬ìŠ¤íŠ¸ë¡œ ê¼­ ì…ë ¥ì„ í•´ì¤˜ì•¼í•œë‹¤.

í•´ë‹¹ methodê°€ ìš”ì²­ì´ ëì„ ë•Œ `post_list` í•¨ìˆ˜ê°€ ì‹¤í–‰ì´ ë˜ê³  

í•¨ìˆ˜ ë‚´ë¶€ì—ì„œëŠ” if ì¡°ê±´ë¬¸ìœ¼ë¡œ ë¶„ê¸° ì²˜ë¦¬ë¥¼ í•œë‹¤.

---

<br>

#### @api_view í™œìš©í•œ êµ¬í˜„ (detail/update/delete)

```python
from rest_framework.decorators import api_view

@api_view(['GET','PUT','DELETE'])
def post_detail(request, pk):
    post = get_object_or_404(Post, pk=pk)

    if request.method == 'GET':
        serializer = PostSerializer(post)
        return Response(serializer.data)

    elif request.method == 'PUT':
        serializer = PostSerilizer(post, data=request.data)
        if serializer.is_valid():
            serializer.save()
            return Responser(serializer.data)
        return Response(serializer.errors, status=HTTP_400_BAD_REQUEST)

    else:
        post.delet()
    
    return Response(status=status.HTTP_204_NO_CONTENT)
```

<br>

ìœ„ ì½”ë“œë“¤ì—ì„œ ë³¼ ìˆ˜ ìˆë“¯ì´ CBV ë˜ëŠ” FBV ëª¨ë‘ ê°™ì€ ì˜ë¯¸ì˜ ì½”ë“œë¥¼ 

êµ¬í˜„í•  ìˆ˜ ìˆë‹¤. ìƒí™©ì— ë§ì¶°ì„œ ì ì ˆí•œ ì„ íƒì„ í•˜ë©´ ë  ê²ƒ ê°™ë‹¤.

---