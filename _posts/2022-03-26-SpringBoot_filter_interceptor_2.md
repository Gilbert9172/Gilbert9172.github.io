---
layout: post
title: Interceptor
categories: springboot
---

# π”  Interceptor

μ¤ν”„λ§ μΈν„°μ…‰ν„°λ„ μ„λΈ”λ¦Ώ ν•„ν„°μ™€ κ°™μ΄ μ›Ήκ³Ό κ΄€λ ¨λ κ³µν†µ κ΄€μ‹¬ μ‚¬ν•­μ„ ν¨κ³Όμ μΌλ΅ 

ν•΄κ²°ν•  μ μλ” κΈ°μ μ΄λ‹¤. μ„λΈ”λ¦Ώ ν•„ν„°κ°€ μ„λΈ”λ¦Ώμ΄ μ κ³µν•λ” κΈ°μ μ΄λΌλ©΄, 

<span style="background-color:#4682B4; color:white">μ¤ν”„λ§ μΈν„°μ…‰ν„°λ” μ¤ν”„λ§ MVCκ°€ μ κ³µν•λ” κΈ°μ </span>μ΄λ‹¤. λ‘λ‹¤ μ›Ήκ³Ό κ΄€λ ¨λ κ³µν†µ κ΄€μ‹¬ μ‚¬ν•­μ„ 

μ²λ¦¬ν•μ§€λ§, μ μ©λλ” μμ„μ™€ λ²”μ„, κ·Έλ¦¬κ³  μ‚¬μ©λ°©λ²•μ΄ λ‹¤λ¥΄λ‹¤.

<br>

## <span style="color:gray">Spring Interceptor</span>

### 1. μΈν„°μ…‰ν„°μ νλ¦„

> HTTP μ”μ²­ β†’ WAS β†’ ν•„ν„° β†’ (Dispatcher)μ„λΈ”λ¦Ώ β†’ μ¤ν”„λ§ μΈν„°μ…‰ν„° β†’ μ»¨νΈλ΅¤λ¬

μ¤ν”„λ§ μΈν„°μ…‰ν„°λ” λ””μ¤ν¨μ² μ„λΈ”λ¦Ώκ³Ό μ»¨νΈλ΅¤λ¬ μ‚¬μ΄μ—μ„ μ»¨νΈλ΅¤λ¬ νΈμ¶ μ§μ „μ— νΈμ¶

μ¤ν”„λ§ μΈν„°μ…‰ν„°λ” μ¤ν”„λ§ MVCκ°€ μ κ³µν•λ” κΈ°λ¥μ΄κΈ° λ•λ¬Έμ— κ²°κµ­ λ””μ¤ν¨μ² μ„λΈ”λ¦Ώ μ΄ν›„μ— λ“±μ¥ 

μ¤ν”„λ§ μΈν„°μ…‰ν„°μ—λ„ URL ν¨ν„΄μ„ μ μ©ν•  μ μλ”λ°, μ„λΈ”λ¦Ώ URL ν¨ν„΄κ³Όλ” λ‹¤λ¥΄κ³ , 

λ§¤μ° μ •λ°€ν•κ² μ„¤μ •ν•  μ μλ‹¤.

<br>

### 2. μΈν„°μ…‰ν„°μ μ ν•

> HTTP μ”μ²­ β†’ WAS β†’ ν•„ν„° β†’ (Dispatcher)μ„λΈ”λ¦Ώ β†’ μ¤ν”„λ§ μΈν„°μ…‰ν„° (μ°¨λ‹¨)

μΈν„°μ…‰ν„°μ—μ„ μ μ ν•μ§€ μ•μ€ μ”μ²­μ΄λΌκ³  νλ‹¨ν•λ©΄ κ±°κΈ°μ—μ„ λμ„ λ‚Ό μλ„ μλ‹¤. 

κ·Έλμ„ λ΅κ·ΈμΈ μ—¬λ¶€λ¥Ό μ²΄ν¬ν•κΈ°μ— λ”± μΆ‹λ‹¤.

<br>

### 3. μΈν„°μ…‰ν„° μ²΄μΈ

> HTTP μ”μ²­ -> WAS -> ν•„ν„° -> μ„λΈ”λ¦Ώ -> μΈν„°μ…‰ν„°1 -> μΈν„°μ…‰ν„°2 -> μ»¨νΈλ΅¤λ¬

μ¤ν”„λ§ μΈν„°μ…‰ν„°λ” μ²΄μΈμΌλ΅ κµ¬μ„±λλ”λ°, μ¤‘κ°„μ— μΈν„°μ…‰ν„°λ¥Ό μμ λ΅­κ² μ¶”κ°€ν•  μ μλ‹¤. 

<br>

### 4. HandlerInterceptor Interface

```java

public interface HandlerInterceptor {
	
	// μ»¨νΈλ΅¤λ¬ νΈμ¶ μ „
	default boolean preHandle(HttpServletRequest request, HttpServletResponse response, 
            Object handler) throws Exception {
		return true;
	}

 	// μ»¨νΈλ΅¤λ¬ νΈμ¶ ν›„
	default void postHandle(HttpServletRequest request, HttpServletResponse response, 
            Object handler, @Nullable ModelAndView modelAndView) throws Exception {
	}

	// μ”μ²­ μ™„λ£ ν›„
	default void afterCompletion(HttpServletRequest request, HttpServletResponse response, 
            Object handler, @Nullable Exception ex) throws Exception {
	}

} 
```

μ„λΈ”λ¦Ώ ν•„ν„°μ κ²½μ° λ‹¨μν•κ² doFilter() ν•λ‚λ§ μ κ³µν•μ§€λ§, μΈν„°μ…‰ν„°λ” 

μ»¨νΈλ΅¤λ¬ β€νΈμ¶ μ „β€, β€νΈμ¶ ν›„β€, β€μ”μ²­ μ™„λ£ μ΄ν›„β€μ™€ κ°™μ΄ λ‹¨κ³„μ μΌλ΅ μ μ„Έλ¶„ν™” λμ–΄ μλ‹¤.

λν• μ„λΈ”λ¦Ώ ν•„ν„°μ κ²½μ° λ‹¨μν request, responseλ§ μ κ³µν–μ§€λ§, 

μΈν„°μ…‰ν„°λ” μ–΄λ–¤ μ»¨νΈλ΅¤λ¬κ°€ νΈμ¶λλ”μ§€ **νΈμ¶ μ •λ³΄**λ„ λ°›μ„ μ μλ‹¤. 

κ·Έλ¦¬κ³  μ–΄λ–¤ modelAndViewκ°€ λ°ν™λλ”μ§€ **μ‘λ‹µ μ •λ³΄**λ„ λ°›μ„ μ μλ‹¤.

<br>

### 5. μ¤ν”„λ§ μΈν„°μ…‰ν„°μ νΈμ¶ νλ¦„

μ •μƒμ μΈ νλ¦„μ κ²½μ° λ‹¤μκ³Ό κ°™λ‹¤.

- **preHandle** 
    - μ»¨νΈλ΅¤λ¬ νΈμ¶ μ „μ— νΈμ¶ λλ‹¤. β†’ λ” μ •ν™•νλ” ν•Έλ“¤λ¬ μ–΄λ‘ν„° νΈμ¶ μ „μ— νΈμ¶λλ‹¤.
    - preHandleμ μ‘λ‹µκ°’μ΄ trueμΌ κ²½μ° λ‹¤μμΌλ΅ μ§„ν–‰
    - falseμΌ κ²½μ° λ”λ” μ§„ν–‰ν•μ§€ μ•λ”λ‹¤.

<br>

- **preHandle**
    - μ»¨νΈλ΅¤λ¬ νΈμ¶ μ „μ— νΈμ¶ λλ‹¤. β†’ λ” μ •ν™•νλ” ν•Έλ“¤λ¬ μ–΄λ‘ν„° νΈμ¶ μ „μ— νΈμ¶λλ‹¤.

<br>

- **afterCompletion**
    - λ·°κ°€ λ λ”λ§ λ μ΄ν›„μ— νΈμ¶λλ‹¤.
    - μ‹¤ν¨ μ„±κ³µμ μ—¬λ¶€μ— κ΄€λ ¨μ—†μ΄ λ¬΄μ΅°κ±΄ νΈμ¶λλ‹¤.

<br>

ν•μ§€λ§ μμ™Έκ°€ λ°μƒν•  κ²½μ°μ—λ” postHandle μ€ νΈμ¶λμ§€ μ•λ”λ‹¤.

afterCompletionμ€ λ¬΄μ΅°κ±΄ νΈμ¶λλ”λ°, μ΄λ–„ μμ™Έμ •λ³΄(ex)λ¥Ό ν¬ν•¨ν•΄μ„ νΈμ¶λλ‹¤.

<br>

### 6. Interceptor κµ¬ν„ν•κΈ°.

β’ HandlerInterceptorλ¥Ό μƒμ†λ°›μ•„ κµ¬ν„ν•λ‹¤.

β’‰ μΈν„°μ…‰ν„° λ“±λ΅

```java
@Configuration
public class WebConfig implements WebMvcConfigurer {

    @Override
    public void addInterceptors(InterceptorRegistry registry) {
        registry.addInterceptor(new MyInterceptor())
                .order(1)
                .addPathPatterns("/**")
                .excludePathPatterns("/css/**", "/*.ico","/error");
}
```

<br>

### μ¶”κ°€. Handler λ©”μ†λ“

```java
// νΈμ¶ν•  μ»¨νΈλ΅¤λ¬ λ©”μ„λ“μ λ¨λ“  μ •λ³΄κ°€ ν¬ν•¨λμ–΄ μλ‹¤.
if (handler isinstanceof HandlerMethod) {
		HandlerMethod hm = (HandlerMethod) handler;
}
```

ν•Έλ“¤λ¬ μ •λ³΄λ” μ–΄λ–¤ ν•Έλ“¤λ¬ λ§¤ν•‘μ„ μ‚¬μ©ν•λ”κ°€μ— λ”°λΌμ„ λ‹¬λΌμ§„λ‹¤. 

μ¤ν”„λ§μ„ μ‚¬μ©ν•λ©΄ μΌλ°μ μΌλ΅ @Controller, @RequestMappingμ„ ν™μ©ν• ν•Έλ“¤λ¬ λ§¤ν•‘μ„ μ‚¬μ©ν•λ”λ°, 

μ΄ κ²½μ° ν•Έλ“¤λ¬ μ •λ³΄λ΅ **HandlerMethod**κ°€ λ„μ–΄μ¨λ‹¤.

λ§μ•½ @Controllerκ°€ μ•„λ‹λΌ μ •μ  λ¦¬μ†μ¤κ°€ νΈμ¶λλ” κ²½μ°μ—λ” **ResourceHttpRequestHandler**κ°€ 

ν•Έλ“¤λ¬ μ •λ³΄λ΅ λ„μ–΄κ³ κΈ° λ•λ¬Έμ— νƒ€μ…μ— λ”°λΌμ„ μ²λ¦¬κ°€ ν•„μ”ν•λ‹¤.

---

<br>

## <span style="color:gray">μ •λ¦¬</span>

μ„λΈ”λ¦Ώ ν•„ν„°μ™€ μ¤ν”„λ§ μΈν„°μ…‰ν„°λ” νΈμ¶λλ” μμ„λ§ λ‹¤λ¥΄κ³ , μ κ³µν•λ” κΈ°λ¥μ€ λΉ„μ·ν•λ‹¤.

ν•μ§€λ§ μ¤ν”„λ§ μΈν„°μ…‰ν„°λ” μ„λΈ”λ¦Ώ ν•„ν„°λ³΄λ‹¤ νΈλ¦¬ν•κ³ , λ” μ •κµν•κ³  λ‹¤μ–‘ν• κΈ°λ¥μ„ μ§€μ›ν•λ‹¤.

κ°„λ‹¨ν•κ² μΈν„°μ…‰ν„°λ” μ¤ν”„λ§ MVCκµ¬μ΅°μ— νΉν™”λ ν•„ν„° κΈ°λ¥μ„ μ κ³µν•λ‹¤κ³  μ΄ν•΄ν•λ©΄ λλ‹¤.

μ¤ν”„λ§ MVCλ¥Ό μ‚¬μ©ν•κ³ , μ„λΈ”λ¦Ώ ν•„ν„°λ¥Ό κΌ­ μ‚¬μ©ν•΄μ•Όν•λ” μƒν™©μ΄ μ•„λ‹λΌλ©΄ μΈν„°μ…‰ν„°λ¥Ό μ‚¬μ©ν•λ” 

κ²ƒμ΄ λ” νΈλ¦¬ν•λ‹¤.

---