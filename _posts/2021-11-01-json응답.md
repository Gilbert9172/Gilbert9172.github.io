---
layout: post
title: JSON ì‘ë‹µ
categories: django
tags: drf
---

### ğŸ’¡ ***Viewì—ì„œ JSONì‘ë‹µ***

ëª¨ë“  ViewëŠ” HttpResponse íƒ€ì…ì˜ ì‘ë‹µì„ í•´ì•¼í•©ë‹ˆë‹¤.

ì¼ë°˜ì ìœ¼ë¡œ ì•„ë˜ì˜ 2ê°€ì§€ ë°©ë²•ì´ ìˆë‹¤.

<br>

1. ì§ì ‘ json.dumpsë¥¼ í†µí•´ ì§ë ¬í™”ëœ ë¬¸ìì—´ì„ íšë“í•˜ì—¬ HttpResponseë¥¼ í†µí•´ ì‘ë‹µ

2. JsonResponse(HttpResponseë¥¼ ìƒì† ë°›ì€ í´ë˜ìŠ¤) ì‚¬ìš©

    - ë‚´ë¶€ì ìœ¼ë¡œ json.dumpsë¥¼ ì‚¬ìš©

    - DjangoJSONEncodeê°€ defualtë¡œ ì§€ì •

<br>

ê·¸ë¦¬ê³  JsonResponseì—ì„œ QuerySetì„ JSON ì§ë ¬í™”ë¥¼ í•  ìˆ˜ ì—†ë‹¤.

ë”°ë¼ì„œ ì•ì—ì„œ ì •ì˜í–ˆë˜ MyJSONEncoderë¥¼ í™œìš©í•  ìˆ˜ ìˆë‹¤.

```python
qs = Post.objects.all()

encoder = MyJSONEncoder

# True: dataê°€ dictì¼ ê²½ìš°
# False: dataê°€ dictì¼ ì•„ë‹ ê²½ìš°
safe = False

json_dumps_params = {'ensure_ascii':False}

# HttpResponseì— ì „í•´ì§€ëŠ” Keyword ì¸ì
kwargw = {}

from Djagno.http import JsonResponse

responser = JsonResponse(qs, encorder, safe, json_dumps_params, **kwargs)
```
---

<br>

### ğŸ’¡ ***DRFë¥¼ í†µí•œ JSONì‘ë‹µ***

```python
qs = Post.objects.all()

serializer = PostSerializer(qs, many=True)

from rest_framework.responser import Response
responser = Responser(serializer.data) # content-type : text/html ë””í´íŠ¸ ì§€ì •
```
Responseì—ëŠ” ë‚´ë¶€ì ìœ¼ë¡œ ë‹¤ì–‘í•œ DRF ì„¤ì •ë“¤ì´ ìˆë‹¤.

ë”°ë¼ì„œ Responseì—ì„œëŠ” "JSON ì§ë ¬í™”"ê°€ Lazyí•˜ê²Œ ë™ì‘í•œë‹¤.

ì‹¤ì œ ì‘ë‹µ ìƒì„± ì‹œì—ëŠ” `.rendered_content` ì†ì„±ì— ì ‘ê·¼í•˜ë©°, ì´ë•Œ ë³€í™˜ì´ ì´ë£¨ì–´ì§„ë‹¤. 

--- 

<br>

#### Responseì™€ APIView

DRFì˜ ëª¨ë“  ViewëŠ” APIViewë¥¼ ìƒì† ë°›ëŠ”ë‹¤. 

APIViewë¥¼ í†µí•´ Responseì— ë‹¤ì–‘í•œ ì†ì„±ì´ ì§€ì •ëœë‹¤.

```python
from rest_framework.views import APIView 

renderer_cls = APIView.renderer_classes[0]
renderer_obj = renderer_cls()

# JSON ë³€í™˜ì„ ìœ„í•œ JSONRenderer ì¸ìŠ¤í„´ìŠ¤
response.accepted_renderer = renderer_obj    
            
response.accepted_media_type = renderer_obj.media_type   # 'application/json'

response.renderer_context = {'view': None, 'args': (), 'kwargs': {}, 'request': None}

response 
# <Response status_code=200, "application/json">
```
---

<br>

### ğŸ’¡ ***ì‹¤ì œ DRF Serializer í™œìš©***

ì•„ë˜ì™€ ê°™ì´ ê°„ê²°í•˜ê²Œ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.

```python
from rest_framework import generics

class PostListAPIView(generics.ListAPIView):
    queryset = Post.objects.all()
    serializer_class = PostModelSerializer

post_list = PostListAPIView.as_view()

```

ListAPIViewëŠ” ì˜¤ì§ list ê¸°ëŠ¥ë§Œì„ í•œë‹¤. 

ListCreateAPIViewëŠ” list + Create ê¸°ëŠ¥ì„ í•œë‹¤.

ì¶”ê°€ì ìœ¼ë¡œ ModelViewSetì€ CRUDë¥¼ ëª¨ë‘ ì§€ì›í•˜ëŠ”ë°, 

ModelViewSetì„ ì‚¬ìš©í•  ê²½ìš° urls.pyì—ì„œ routerë¥¼ ê¼­ ì„¤ì •í•´ì¤˜ì•¼ í•œë‹¤.

---

<br>

#### í¬ìŠ¤íŒ… ì¡°íšŒ ì‘ë‹µì— username ì‘ë‹µí•˜ê¸°.

ï¼‘. ReadOnlyField í™œìš©

```python
# serializers.py

from rest_framework import serializers
from .models import Post

class PostSerializer(serializers.ModelSerializer):
    username = serializers.ReadOnlyField(source='author.username')

    class Meta:
        model = Post
        fields = [
            'pk',
            'username',
            'message',
            'created_at',
            'updated_at'
        ]
```

<img src="/assets/img/django/username1.png">

<br>

ï¼’. Class ìƒì† ë°©ì‹

```python
# serializers.py
from django.contrib.auth import get_user_model 
from rest_framework import serializers
from .models import Post

class AuthSerializer(serializers.ModelSerializer):
    class Meta:
        model = Post
        fields = ['username','email']

class PostSerialize(serializers.ModelSerializer):
    class Meta:
        model = Post
        fields = [
            'pk',
            'author',
            'message',
            'created_at',
            'updated_at'
        ]
```

<img src="/assets/img/django/username2.png">

---