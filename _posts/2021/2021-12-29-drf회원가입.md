---
layout: post
title: DRF íšŒì›ê°€ì… êµ¬í˜„ 
categories: django
tags : drf  
---

ì˜¤ëŠ˜ ê³µë¶€í•œ "DRFë¡œ íšŒì›ê°€ì… êµ¬í˜„í•˜ê¸°"ì—ì„œ ë°°ìš´ ë¶€ë¶„ê³¼, ì˜¤ë¥˜ í•´ê²° ë° í•´ê²° ë°©ë²•ì„ ì •ë¦¬í–ˆë‹¤. 

### ğŸ’»  *** ë§ˆì£¼ì¹œ ì˜¤ë¥˜ & í•´ê²°ë°©ë²• ***

ğŸ“ **[ì½”ë“œ](https://github.com/Gilbert9172/DRF_Practice)**

<br>

#### âŒ íšŒì›ê°€ì…ì‹œ ìƒê¸´ ì˜¤ë¥˜.

> ì—ëŸ¬ë©”ì„¸ì§€ : create_user() got an unexpected keyword argument 'phone'

ì˜¤ë¥˜ ì›ì¸ : usermanagerë¥¼ ì»¤ìŠ¤í…€ í•  ë•Œ **`phone`** ë§¤ê°œë³€ìˆ˜ë¥¼ ë„˜ê²¨ì£¼ì§€ ì•Šì•˜ë‹¤.

í•´ê²° ë°©ë²• : /accounts/managers.pyë¥¼ ìˆ˜ì •í•´ì¤Œìœ¼ë¡œ í•´ê²°.

- [í•´ê²° ë§í¬](https://stackoverflow.com/questions/6007556/django-registration-create-user-unexpected-keyword)

<br>

#### âŒ JWTì—ì„œ ë””ì½”ë”© ì˜¤ë¥˜. 

> ì—ëŸ¬ë©”ì„¸ì§€ : jwt.exceptions.DecodeError: ... "algorithms" argument when calling decode()

ì˜¤ë¥˜ ì›ì¸ : decode ë©”ì†Œë“œì˜ ë§¤ê°œë³€ìˆ˜ì¸ **`algorithm`** ì„ ì§€ì •í•´ì£¼ì§€ ì•Šì•„ì„œ ìƒê¸´ ì˜¤ë¥˜ì˜€ë‹¤.

í•´ê²° ë°©ë²• : algorithm = 'HS256'ìœ¼ë¡œ ì§€ì •í•´ì£¼ì—ˆë‹¤. (ìœ ë·°ë¸Œ ê°•ì˜ ëŒ“ê¸€í™•ì¸.)

- [í•´ê²° ë§í¬](https://www.youtube.com/watch?v=XOB-aHKu6e4&list=PLx-q4INfd95EsUuON1TIcjnFZSqUfMf7s&index=6)

```python

token_decoding = jwt.decode(token, os.getenv('SECRET_KEY'), 'HS256') 

# ì¶œë ¥ ê²°ê³¼
{
    'token_type': 'access',
    'exp': 1640763234,
    'iat': 1640762334, 
    'jti': '37edb32aebc249a3a4e5102e42708d2d',
    'user_id': 19
}
```
---

<br>

### âŒ  ì´ë©”ì¼ ì „ì†¡ ì˜¤ë¥˜.

> ì—ëŸ¬ë©”ì„¸ì§€ : smtplib.SMTPAuthenticationError: ...password required

ì˜¤ë¥˜ ì›ì¸ :  'ë©”ì¼App ë¹„ë°€ë²ˆí˜¸'ê°€ ì„¤ì •ë˜ì–´ ìˆì§€ ì•Šì•˜ë‹¤.

í•´ê²° ë°©ë²• : App ë¹„ë°€ë²ˆí˜¸ ì„¤ì •.

- [í•´ê²° ë§í¬](https://greensul.tistory.com/31)

---

<br>

#### âŒ  Migration ì˜¤ë¥˜.

- í•´ê²°ë°©ë²•1

â’ˆ migration í´ë” ì‚­ì œ

â’‰ ë‹¤ì‹œ migrate

<br>

- í•´ê²°ë°©ë²•2

â’ˆ DB ì‚­ì œ 

â’‰ ë‹¤ì‹œ migrate 

--- 

<br>

### ğŸ’¡ *** ì•Œê²Œ ëœ ë¶€ë¶„ ***

<br>

#### 1. runserver 

```txt
python manage.py runsercer í˜¸ìŠ¤íŠ¸:í¬íŠ¸ 
```
í•´ë‹¹ **`í˜¸ìŠ¤íŠ¸:í¬íŠ¸`** ë¡œ ì„œë²„ê°€ ì‹œì‘ëœë‹¤.

<br>

#### 2. Email ë³´ë‚´ê¸°

```python
# settings.py

EMAIL_BACKEND = "django.core.mail.backends.smtp.EmailBackend"
EMAIL_USE_TLS = True
EMAIL_HOST = 'smtp.gmail.com'
EMAIL_PORT = 587
EMAIL_HOST_USER = os.getenv('EMAIL_HOST_USER')
EMAIL_HOST_PASSWORD = os.getenv('EMAIL_HOST_PASSWORD')
SERVER_EMAIL = os.getenv('EMAIL_HOST_PASSWORD')
DEFAULT_FROM_MAIL = os.getenv("SERVER_EMAIL")
```

```python
# utils.py
from django.core.mail import EmailMessage
import threading


class EmailThread(threading.Thread):

    def __init__(self, email):
        self.email = email
        threading.Thread.__init__(self)

    def run(self):
        self.email.send()

class Util:
    @staticmethod
    def send_email(data):
        email = EmailMessage(
            subject=data['email_subject'], body=data['email_body'], to=[data['to_email']])
        EmailThread(email).start()
```
- [ì´ë©”ì¼ ì„¤ì •](https://inma.tistory.com/115)

---

<br>

#### 3. @staticmethod & @classmethod


ì •í™•í•˜ê²Œ ì´í•´í•˜ì§„ ëª»í–ˆì§€ë§Œ, @classmethodê³¼ @staticmethodì˜ ì°¨ì´ëŠ” ìƒì†ì—ì„œ 

ë‘ë“œëŸ¬ì§€ëŠ” ê²ƒ ê°™ë‹¤.

```python
class Person:
    default= "ì•„ë¹ "
    
    def __init__(self):
        self.data = self.default
    
    @classmethod
    def class_person(cls):
        return cls()
    
    @staticmethod
    def static_person():
        return Person()
    
class WhatPerson(Person):
    default = "ì—„ë§ˆ"

person1 = WhatPerson.class_person()     # ì—„ë§ˆ 
person2 = WhatPerson.static_person()    # ì•„ë¹ 
```

- [ì°¸ê³  ë¸”ë¡œê·¸](https://hckcksrl.medium.com/python-%EC%A0%95%EC%A0%81%EB%A9%94%EC%86%8C%EB%93%9C-staticmethod-%EC%99%80-classmethod-6721b0977372)

---

<br>

#### 4. validate_field() VS validate()

íŠ¹ì • í•„ë“œì— ëŒ€í•œ ìœ íš¨ì„± ê²€ì‚¬ë¥¼ ì§„í–‰í•  ë•Œì—ëŠ” **`validate_field`** ë©”ì„œë“œë¥¼ í˜¸ì¶œí•˜ì—¬ ì‚¬ìš©í•œë‹¤. 

í•˜ì§€ë§Œ ë‘ ê°œ ì´ìƒì˜ í•„ë“œì— ëŒ€í•´ì„œ ìœ íš¨ì„± ê²€ì‚¬ë¥¼ ì§„í–‰í•  ë•Œì—ëŠ” **`validate`** ë©”ì„œë“œë¥¼

í˜¸ì¶œí•˜ì—¬ ì‚¬ìš©í•œë‹¤. ì¶”ê°€ì ìœ¼ë¡œ attrsëŠ” OrderDict í´ë˜ìŠ¤ë¥¼ ë°˜í™˜í•´ ì¤€ë‹¤. 


```python
def validate(self, attrs):
    email = attrs.get('email', ' ')
    username = attrs.get('username',' ')

    if not email:
        raise serializers.ValidationError(self.default_error_messages)

    # .isalum() ë¬¸ìì—´ì´ ì˜ì–´, í•œê¸€ í˜¹ì€ ìˆ«ìë¡œ ë˜ì–´ìˆìœ¼ë©´ ì°¸ ë¦¬í„´, ì•„ë‹ˆë©´ ê±°ì§“ ë¦¬í„´.
    if not username.isalnum():
        raise serializers.ValidationError(self.default_error_messages)

    return super().validate(attrs)

# attrs ì¶œë ¥ê°’.
"""
OrderedDict(
    [
        ('email', 'test@test.com'),
        ('username', 'test'),
        ('gender', 'M'),
        ('phone', '010-1234-1234'),
        ('password', 'test')
    ]
)
"""
```

- [ì°¸ê³  ë¸”ë¡œê·¸](https://brownbears.tistory.com/71)

---

<br>

### ğŸ“š References
- [ìœ íŠœë¸Œ ê°•ì˜](https://www.youtube.com/watch?v=M61KIo4DAqs&list=PLx-q4INfd95EsUuON1TIcjnFZSqUfMf7s&index=7)
- [ê°•ì˜ ì†ŒìŠ¤ì½”ë“œ](https://github.com/CryceTruly/incomeexpensesapi)
- [DRF ì†ŒìŠ¤ì½”ë“œ](https://github.com/Gilbert9172/django-rest-framework/tree/00cd4ef864a8bf6d6c90819a983017070f9f08a5/rest_framework)
